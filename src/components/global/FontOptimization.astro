---
/**
 * FontOptimization.astro
 * 
 * This component optimizes font loading for better performance and SEO.
 * It uses the font-display: swap strategy and preloads critical fonts.
 */
---

<!-- Font preloading for critical fonts -->
<link rel="preload" href="/fonts/main-font.woff2" as="font" type="font/woff2" crossorigin />

<!-- Font loading optimization -->
<style is:inline>
  /* Font display strategy to prevent invisible text during font loading */
  @font-face {
    font-family: 'Main Font';
    src: url('/fonts/main-font.woff2') format('woff2');
    font-weight: 400;
    font-style: normal;
    font-display: swap;
  }
  
  /* Optional fonts can use font-display: swap as well */
  @font-face {
    font-family: 'Main Font';
    src: url('/fonts/main-font-bold.woff2') format('woff2');
    font-weight: 700;
    font-style: normal;
    font-display: swap;
  }
  
  /* Font fallback to prevent layout shifts */
  html {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  }
  
  /* Apply main font once loaded */
  .fonts-loaded {
    font-family: 'Main Font', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  }
</style>

<!-- Font loading detection script -->
<script>
  // Use the Font Loading API to detect when fonts are loaded
  if ('fonts' in document) {
    Promise.all([
      document.fonts.load('1em "Main Font"'),
      document.fonts.load('bold 1em "Main Font"')
    ]).then(() => {
      document.documentElement.classList.add('fonts-loaded');
    });
  } else {
    // Fallback for browsers that don't support the Font Loading API
    document.documentElement.classList.add('fonts-loaded');
  }
</script>