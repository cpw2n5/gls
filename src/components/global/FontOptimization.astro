---
/**
 * FontOptimization.astro
 * 
 * This component optimizes font loading for better performance and SEO.
 * It uses the font-display: swap strategy and preloads critical fonts.
 */
---

<!-- Font preloading for critical fonts -->
<link rel="preload" href="/fonts/main-font.woff2" as="font" type="font/woff2" crossorigin />
<link rel="preload" href="/fonts/main-font-bold.woff2" as="font" type="font/woff2" crossorigin />

<!-- Font loading optimization -->
<style is:inline>
  /* Font display strategy to prevent invisible text during font loading */
  @font-face {
    font-family: 'Inter';
    src: url('/fonts/main-font.woff2') format('woff2');
    font-weight: 400;
    font-style: normal;
    font-display: swap;
  }
  
  /* Optional fonts can use font-display: swap as well */
  @font-face {
    font-family: 'Inter';
    src: url('/fonts/main-font-bold.woff2') format('woff2');
    font-weight: 700;
    font-style: normal;
    font-display: swap;
  }
  
  /* Font fallback to prevent layout shifts */
  html {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  }
  
  /* Apply main font once loaded */
  .fonts-loaded {
    font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  }
</style>

<!-- Font loading detection script with improved performance -->
<script>
  // Use the Font Loading API to detect when fonts are loaded
  if ('fonts' in document) {
    // Add a timeout to ensure the page remains usable even if fonts take too long
    const fontPromise = Promise.all([
      document.fonts.load('1em "Inter"'),
      document.fonts.load('bold 1em "Inter"')
    ]);
    
    // Race between font loading and timeout
    Promise.race([
      fontPromise,
      new Promise(resolve => setTimeout(resolve, 2000)) // 2 second timeout
    ]).then(() => {
      (document as Document).documentElement.classList.add('fonts-loaded');
    });
    
    // Still add the class when fonts are eventually loaded
    fontPromise.then(() => {
      (document as Document).documentElement.classList.add('fonts-loaded');
    });
  } else {
    // Fallback for browsers that don't support the Font Loading API
    // Add type assertion to fix TypeScript error
    (document as Document).documentElement.classList.add('fonts-loaded');
  }
</script>