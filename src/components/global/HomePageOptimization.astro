---
/**
 * HomePageOptimization.astro
 *
 * This component provides specific optimizations for the home page.
 * It ensures critical CSS is properly inlined and non-critical resources are deferred.
 */
---

<script>
  // This script runs on the client side to optimize the loading of resources
  document.addEventListener('DOMContentLoaded', () => {
    // Find the problematic _slug_ CSS file
    const slugCssLinks = Array.from(document.querySelectorAll('link[href*="_slug_"]'));
    
    if (slugCssLinks.length > 0) {
      // For each slug CSS file found
      slugCssLinks.forEach(link => {
        // Get the href
        const href = link.getAttribute('href');
        if (!href) return;
        
        // Create a new link element with non-blocking attributes
        const optimizedLink = document.createElement('link');
        optimizedLink.rel = 'stylesheet';
        optimizedLink.href = href;
        optimizedLink.media = 'print';
        if ('fetchpriority' in optimizedLink) {
          optimizedLink.fetchpriority = 'low';
        }
        
        // Replace the original link with the optimized one
        link.parentNode?.replaceChild(optimizedLink, link);
        
        // Switch to 'all' media after the page has loaded
        window.addEventListener('load', () => {
          setTimeout(() => {
            optimizedLink.media = 'all';
          }, 0);
        });
      });
    }
    
    // Prefetch pages that are likely to be visited next
    const pagesToPrefetch = ['/calculators', '/articles', '/guides'];
    
    pagesToPrefetch.forEach(page => {
      const link = document.createElement('link');
      link.rel = 'prefetch';
      link.href = page;
      document.head.appendChild(link);
    });
  });
</script>

<!-- Additional critical CSS specifically for the home page hero section -->
<style is:inline>
  /* Button styles for the hero section */
  .bg-white.text-primary-700 {
    background-color: white;
    color: #1a56db;
    transition: background-color 0.2s;
  }
  
  .bg-white.text-primary-700:hover {
    background-color: #f9fafb;
  }
  
  .bg-transparent.border.border-white {
    background-color: transparent;
    border: 1px solid white;
    color: white;
    transition: background-color 0.2s;
  }
  
  .bg-transparent.border.border-white:hover {
    background-color: rgba(255, 255, 255, 0.1);
  }
  
  .rounded-lg {
    border-radius: 0.5rem;
  }
  
  .px-6 {
    padding-left: 1.5rem;
    padding-right: 1.5rem;
  }
  
  .py-3 {
    padding-top: 0.75rem;
    padding-bottom: 0.75rem;
  }
  
  .font-medium {
    font-weight: 500;
  }
</style>