---
import Header from "../components/global/Header.astro";
import Footer from "../components/global/Footer.astro";
import SEO from "../components/global/SEO.astro";
import ConsentManager from "../components/global/ConsentManager.astro";
import Analytics from "../components/analytics/Analytics.astro";
import FontOptimization from "../components/global/FontOptimization.astro";
import CSSOptimization from "../components/global/CSSOptimization.astro";

interface Props {
	title: string;
	description?: string;
	canonicalUrl?: string;
	image?: string;
	type?: 'website' | 'article' | 'calculator';
	publishDate?: Date;
	updatedDate?: Date;
	author?: string;
	tags?: string[];
	section?: string;
	noIndex?: boolean;
	breadcrumbs?: {
		name: string;
		url: string;
	}[];
}

const {
	title,
	description = "Financial tools, calculators, and informative articles to help you get your life sorted.",
	canonicalUrl,
	image,
	type = 'website',
	publishDate,
	updatedDate,
	author,
	tags,
	section,
	noIndex,
	breadcrumbs
} = Astro.props;

// Import CSS but don't bundle it - we'll handle it with our optimization strategy
import "../styles/global.css";

// Determine if we're on the home page
const isHomePage = Astro.url.pathname === '/' || Astro.url.pathname === '';
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<!-- Favicon and Apple Touch Icon -->
		<link rel="icon" href="/favicon.svg" type="image/svg+xml">
		<link rel="apple-touch-icon" href="/favicon.svg">
		
		<!-- DNS prefetch and preconnect for external resources -->
		<link rel="dns-prefetch" href="//getlifesorted.com" />
		<link rel="preconnect" href="https://getlifesorted.com" crossorigin />
		
		<!-- Font optimization is handled by FontOptimization.astro -->
		
		<SEO
			title={title}
			description={description}
			canonicalUrl={canonicalUrl}
			image={image}
			type={type}
			publishDate={publishDate}
			updatedDate={updatedDate}
			author={author}
			tags={tags}
			section={section}
			noIndex={noIndex}
			breadcrumbs={breadcrumbs}
		/>
		
		<!-- CSS Optimization must come before other CSS -->
		<CSSOptimization />
		<FontOptimization />
		<Analytics />
		
		<!-- Add resource hints for faster loading -->
		{isHomePage && (
			<>
				<!-- Preconnect to origins of critical resources -->
				<link rel="preconnect" href={Astro.url.origin} crossorigin />
				
				<!-- Prefetch important pages users might navigate to -->
				<link rel="prefetch" href="/calculators" />
				<link rel="prefetch" href="/articles" />
				<link rel="prefetch" href="/guides" />
			</>
		)}
	</head>
	<body class="min-h-screen flex flex-col bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100">
		<Header />
		<main class="flex-grow">
			<slot />
		</main>
		<Footer />
		<ConsentManager />
	</body>
</html>
